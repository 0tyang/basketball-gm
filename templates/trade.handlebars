<script type="text/javascript">
$(document).ready(function() {
  // Don't use the dropdown function because this needs to be a POST
  $('#trade_select_team').change(function(event) {
    $.ajax({
      type: 'POST',
      url: 'url_for(trade_, lid=g.lid)',
      data: {'json': 1, 'abbrev': $('#trade_select_team').val()},
      success: function (data) {
        ajax_update(data);
      },
      dataType: 'json'
    });
  });

  bbgm.datatableSinglePage($('#roster_user'), 5, [
    {{#userRoster}}
      [ '<input name="pids_user" type="checkbox" value="{{pid}}"{{#if selected}} checked="checked"{{/if}}>', '<a href="/l/{{../g.lid}}/player/{{pid}}">{{name}}</a>', '{{pos}}', '{{age}}', '{{ovr}}', '{{pot}}', '${{round contract_amount 1}}M through {{contract_exp}}', '{{round min 1}}', '{{round pts 1}}', '{{round reb 1}}', '{{round ast 1}}' ],
    {{/userRoster}}
  ]);

  bbgm.datatableSinglePage($('#roster_other'), 5, [
    {{#otherRoster}}
      [ '<input name="pids_other" type="checkbox" value="{{pid}}"{{#if selected}} checked="checked"{{/if}}>', '<a href="/l/{{../g.lid}}/player/{{pid}}">{{name}}</a>', '{{pos}}', '{{age}}', '{{ovr}}', '{{pot}}', '${{round contract_amount 1}}M through {{contract_exp}}', '{{round min 1}}', '{{round pts 1}}', '{{round reb 1}}', '{{round ast 1}}' ],
    {{/otherRoster}}
  ]);

  roster_checkboxes_user = $('#roster_user input')
  var roster_checkboxes_other = $('#roster_user input')
  $('#rosters input[type="checkbox"]').click(function(event) {
    $('#propose_trade button').attr('disabled', 'disabled'); // Will be reenabled, if appropriate, when the summary is loaded
    $.post('url_for(trade_update, lid=g.lid)', $('#rosters').serialize(), function (data) {
      $('#trade_summary').html(data['summary']);
      for (var i=0; i<roster_checkboxes_user.length; i++) {
        var found = false;
        for (var j=0; j<data['pids_user'].length; j++) {
          if (roster_checkboxes_user[i].value == data['pids_user'][j]) {
            roster_checkboxes_user[i].checked = true;
            found = true;
            break;
          }
        }
        if (!found) {
          roster_checkboxes_user[i].checked = false;
        }
      }
    }, 'json');
  });

  $('#clear_trade button, #propose_trade button').click(function(event) {
//    $(this).attr('disabled', 'disabled');
  });
});
</script>

<h1>Trade</h1>

<div class="row-fluid">
  <div class="span7">
    <form id="rosters">
      <p><select id="trade_select_team" name="team" class="team form-inline">
        {{#teams}}
          <option value="{{abbrev}}"{{#if selected}} selected="selected"{{/if}}}>{{region}} {{name}}</option>
        {{/teams}}
      </select>
      <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-condensed" id="roster_other">
      <thead>
        <tr><th></th><th>Name</th><th title="Position">Pos</th><th>Age</th><th title="Overall Rating">Ovr</th><th title="Potential Rating">Pot</th><th>Contract</th><th title="Minutes Per Game">Min</th><th title="Points Per Game">Pts</th><th title="Rebounds Per Game">Reb</th><th title="Assists Per Game">Ast</th></tr>
      </thead>
      </table>
      </p>

      <h2>{{summary.0.teamName}}</h2>
      <p>
      <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered table-condensed" id="roster_user">
      <thead>
        <tr><th></th><th>Name</th><th title="Position">Pos</th><th>Age</th><th title="Overall Rating">Ovr</th><th title="Potential Rating">Pot</th><th>Contract</th><th title="Minutes Per Game">Min</th><th title="Points Per Game">Pts</th><th title="Rebounds Per Game">Reb</th><th title="Assists Per Game">Ast</th></tr>
      </thead>
      </table>
      </p>
    </form>
  </div>
  <div class="span5" id="trade_summary">
    {{{tradeSummary}}}
  </div>
</div>